{
  "name": "Hard Cider",

  "questions": [
    {
      "label": "Does the juice has preservatives; sorbates, sorbitol, or sulfite?",
      "variableId": "isUnsuitable"
    },
    {
      "label": "Is the juice cloudy?",
      "variableId": "isCloudy"
    },
    {
      "label": "How much liquid?",
      "variableId": "volumeInL"
    },
    {
      "label": "Measure the original gravity of the juice. (ex. 1.020)",
      "variableId": "og"
    },
    {
      "label": "What is the efficiency of your yeast?",
      "variableId": "yeastEfficiency"
    },
    {
      "label": "How much alcohol do you want in percent? Suggest > 7.0 for long storage.",
      "variableId": "degreeAlcool"
    },
    {
      "label": "What is the ppg of your sugar.",
      "variableId": "sugarPpg"
    },
    {
      "label": "From 0 (no tannin) to 10 (full blown tannin)",
      "variableId": "tanninLvl"
    },
    {
      "label": "What is the PH of the juice?",
      "variableId": "juicePh"
    },
    {
      "label": "What is required PH of the juice?",
      "variableId": "finalPh"
    }
  ],

  "data": {
    "isUnsuitable": { "type": "boolean" },
    "isCloudy": { "type" : "boolean" },
    "volumeInL": { "type" : "volume" },
    "og": { "type" : "text" },
    "tanninLvl": { "type" : "text" },
    "yeastEfficiency": { "type" : "text" },
    "degreeAlcool": { "type" : "text" },
    "sugarPpg": { "type" : "text" },
    "juicePh": { "type" : "text" },
    "finalPh": { "type" : "text" },

    "pecticEnzymeInG": {
      "type" : "computed",
      "compute": "528.34 * {{volumeInL}} / 1000"
    },
    "potassMetaInG": {
      "type" : "computed",
      "compute": "((52.7*({{juicePh}}*{{juicePh}}*{{juicePh}}) - 459*({{juicePh}}*{{juicePh}}) + 1352.6*{{juicePh}} - 1338.6) / 0.57) * {{volumeInL}} / 1000"
    },
    "yeastNutrientInG": {
      "type" : "computed",
      "compute": "217.94 * {{volumeInL}} / 1000"
    },
    "chaptizeSugarKg": {
      "type" : "computed",
      "compute": "((((4 * {{degreeAlcool}})/(525 * {{yeastEfficiency}}) - {{og}} + 1) * 1000) / ({{sugarPpg}} * 2.20462 * 3.78541)) * {{volumeInL}}"
    },
    "tanninG": {
      "type": "computed",
      "compute": "(({{tanninLvl}} / 10) * 160) * {{volumeInL}} / 1000"
    },
    "acidAddition": {
      "type" : "computed",
      "compute": "(Math.pow((Math.pow(10, -{{finalPh}}) - Math.pow(10, -{{juicePh}})), 2) / 7.94E-5 + (Math.pow(10, -{{finalPh}}) - Math.pow(10, -{{juicePh}}))) * {{volumeInL}} * 176.12"
    }
  },

  "steps": [
    {
      "hidden": "!{{isUnsuitable}}",
      "template": "This juice is unsuitable for cider making, you may continue at your own risk."
    },
    {
      "hidden": "!{{isCloudy}}",
      "template": "Add {{pecticEnzymeInG}} g of pectic enzyme."
    },
    {
      "template": "Add {{potassMetaInG}} g of potassium metabisulfite. Blend with juice first to dissolve."
    },
    {
      "template": "Allow 3 hours for potassium metabisulfite to act."
    },
    {
      "template": "Add yeast nutrient. Roughly {{yeastNutrientInG}} g, could need more as fermentation goes."
    },
    {
      "template": "Add your sugar. {{chaptizeSugarKg}} kg to achieve the alcohol you requested."
    },
    {
      "template": "Add {{acidAddition}} g of ascetic acid to achieve required PH."
    },
    {
      "template": "Add {{tanninG}} g of wine tannin."
    },
    {
      "template": "Add English ale yeast"
    },
    {
      "template": "Stir yeast in."
    },
    {
      "template": "Think to add ~.5% ABV for bottle priming"
    }
  ]
}