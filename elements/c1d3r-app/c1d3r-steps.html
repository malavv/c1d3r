<dom-module id="c1d3r-steps">
  <style>
    :host {}
    :host div.step {
      background-color: #fafafa;
      border-bottom: 1px solid #cdcdcd;
    }
    :host div.step span.quantity {
      border: 1px solid purple;
      padding: 0 5px;
      color: purple;
      border-radius: 5px;
      margin: 0 5px;
    }
    :host div.step span.idx {
      padding: 0 5px;
      color: #aaa;
      border-radius: 5px;
      margin: 0 5px;
    }
    :host iron-selector > :not(.iron-selected) {
        display: none;
    }
  </style>

    <template>
      <div>
        <template is="dom-repeat" items="{{steps}}" as="step">
          <div class="step">
            <span class="idx">[[index]]</span>
            <iron-selector attr-for-selected="type" selected="{{step.type}}">
              <div type="show">{{step.template}}</div>
              <div type="template">{{fillTmpl(step, data, data.*)}}</div>
              <div type="if">
                <div hidden$="{{cif(step, data, data.*)}}">{{step.template}}</div>
              </div>
            </iron-selector>
          </div>
        </template>
      </div>
    </template>

    <script>
    (function() {
    'use strict';

      Polymer({
        is: 'c1d3r-steps',

        properties: {
          steps: {
            type: Array
            
          },
          data: {
            type: Object
          }
        },

        cif: function(step, data) {
          if (step.type !== 'if')
            return true;
          return !this.data[step.bind].value;
        },

        fillTmpl: function(step, data) {
          if (step.type !== "template")
            return;
          var value = data[step.bind].value;

          if (value !== undefined && typeof(value.toFixed) === "function") {
            value = value.toFixed(2);
          }
          return step.template.replace('{}', value);
        },

        onEntersView: function() {
          this.steps.forEach(function(step, idx) {
            if (step.type === 'if')
              this.set('steps.' + idx + '.isHidden', this.data[step.bind].value);
          }, this);
          console.log('c1d3r-steps', 'onEntersView');
        },
        onExitsView: function() {
          console.debug('c1d3r-steps', 'onExitsView');
        }
      });
    })()
    </script>
</dom-module>