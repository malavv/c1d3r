<dom-module id="c1d3r-recipe">
    <style>
        :host {}
    </style>

    <template>
        <h1>C1d3r : The recipe</h1>
    </template>

    <script>
    (function() {
        'use strict';
        /**
         * This is the standard recipe but there can be as much as you want.
         */
        Polymer({
            is: 'c1d3r-recipe',

            properties: {
              name: {
                type: String,
                value: 'Hard Cider'
              },
              juice: {
                type: Object,
                notify: true,
                value: function() { return {}; }
              },
              // Getting the info
              questions: {
                type: Array,
                value: function() { return []; }
              },
              // Steps to make the cider.
              steps: {
                type: Array,
                value: function() { return []; },
                notify: true
              },
              numAnswered: {
                type: Number,
                notify: true
              }
            },

            observers: [
              'juiceDataChanged(juice.*)'
            ],

            juiceDataChanged: function(val) {
              if (this.steps === undefined)
                return;
              this.clearSteps();
              this.buildSteps();
              this.notifyPath('steps', this.steps);
            },
            ready: function() {
              // Boolean default to false.
              this.juice.isCloudy = false;
              this.set('numAnswered', 1);

              this.push('questions', {
                boundTo: "isUnsuitable",
                label: "Does the juice has preservatives; sorbates, sorbitol, or sulfite?",
                type: "boolean",
                isAnswered: true
              });

              this.push('questions', {
                boundTo: "isCloudy",
                label: "Is the juice cloudy?",
                type: "boolean",
                isAnswered: true
              });
              this.push('questions', {
                boundTo: "producer",
                label: "What the name of the producer?",
                type: "text"
              });
              this.push('questions', {
                boundTo: "volume",
                label: "How much liquid?",
                type: "volume"
              });
            },
            getNumberAnswered: function() {
              return this.questions.filter(function(q) { return q.isAnswered; }).length;
            },
            clearSteps: function() {
              while(this.steps.length > 0) this.pop('steps');
            },
            makeStepLabel: function(data) {
              var token = data.text.split("{}"), arr = [];
              if (token.length <= 1) {
                arr.push({
                  kind: '',
                  content: token[0]
                });
              }
              if (token.length == 2) {
                arr.push({
                  kind: '',
                  content: token[0]
                });
                arr.push({
                  kind: 'quantity',
                  content: data.value + ' ' + data.symbol
                });
                arr.push({
                  kind: '',
                  content: token[1]
                });
              }
              return {
                cmpt: arr
              }
            },
            buildSteps: function() {
              console.log(this.name + ' Building Steps');

              if (this.juice.isUnsuitable) {
                this.steps.push(this.makeStepLabel({
                  text: "This juice is unsuitable for cider making, you may continue at your own risk."
                }));
              }

              if (this.juice.isCloudy && this.juice.volume) {
                this.steps.push(this.makeStepLabel({
                  text: "Add {} of pectic enzyme.",
                  value: this.juice.volume.replace("L", "") * 0.264 * 0.5,
                  symbol: "tsp"
                }));
              }
            }
        });
    })()
    </script>
</dom-module>