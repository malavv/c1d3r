<dom-module id="c1d3r-recipe">
    <script>
    (function() {
        'use strict';

        /**
         * This is the standard recipe but there can be as much as you want.
         */
        Polymer({
            is: 'c1d3r-recipe',

            properties: {
              configuration: {
                type: Object,
                observer: '_newConfig'
              },
              name: {
                type: String,
                notify: true
              },
              data: {
                type: Object,
                notify: true,
                value: function() { return {}; }
              },
              questions: {
                type: Array,
                value: function() { return []; },
                notify: true
              },
              steps: {
                type: Array,
                value: function() { return []; },
                notify: true
              }
            },

            observers: [
              '_recompute(data, data.*)'
            ],

            _recompute: function(data) {
              var toRecompute = Object.getOwnPropertyNames(this.data)
                .map(function(key) { return this.data[key]; }, this)
                .filter(function(variable) { return variable.type === 'computed'; })
                .map(function(variable) {
                  var filled = C.fillTemplate(variable.compute, this.data);
                  return {
                    name: variable.name,
                    template: filled,
                    value: adjustValue(eval(filled))
                  };
                }, this)
                .forEach(function(variable) {
                  this.set('data.' + variable.name + '.value', variable.value);
                }, this);
            },

            _newConfig: function(ciderConf) {
              this.name = ciderConf.name;
              this.questions = ciderConf.questions;

              // Add name to variable.
              Object.getOwnPropertyNames(ciderConf.data).forEach(function(k) { ciderConf.data[k].name = k; });
              // Set boolean to false.
              Object.getOwnPropertyNames(ciderConf.data).forEach(function(k) {
                if (ciderConf.data[k].type !== 'boolean') return;
                ciderConf.data[k].value = false;
              });

              this.data = ciderConf.data;
              this.steps = ciderConf.steps;
              console.info('Loading new recipe config', ciderConf);
            }
        });

      function adjustValue(val) {
        if (isNaN(val)) return undefined;
        if (val.toFixed === undefined) return val;
        return val.toFixed(1);
      }

    })()
    </script>
</dom-module>